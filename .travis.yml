language: python
python: '3.7'
dist: xenial
sudo: true
services:
    - postgresql
env:
    global:
        - DB_HOST=127.0.0.1
        - DB_PORT=5432
        - secure: "NmozfuSceEaSz6PcBZ7WBa2RkdGATz5LWU6WjNX/KNpoZhAQskj81kmYjfz3KUR0bTAy6XTE8XRQexXU4D88hw8ifSdQUpMoYp4oagtyb1yto40W3gY7mnOu/w0JYvQ20boCej/sk+l8QlEIFB8+fOS6HS4CQg/VjR3OiIrdPrqNBbpNkVnnIp+S72eD+58N5yc5iMgA5akCgv9Z/oDowO+jBTTMc6yti+YmtRaB2RlBt9wiLpgI4llmGgeGthIrqBqA0kKxa3ukbHhUYg/xlRN8s12cYSVp1+oU0n9UsCHvMOtbAVc0iSadkI7C+x02tsB4Bwh8cQxwvHTQ6gvB9sKjS16ty2yR/3jLnC1M/7i/+6nX09H/fkIc1GhE4bzx3oIo1sz3SZAUWWbbQ08E8+Uf+/450FTjEWtFvasD8uTLpHtnLdxyzHsxhRkto3UYv/eRVna64SYx+p3V2nCOYxHOeQL962bXO+t7KHZSZh3bjt0aUTdtUIDBWCUXx+BCDHHy7uSh1V1vrfUq6p53rii1S8YiNmCmJ4uBqyZVjRmntm0Q3lKp7IV948azE9pHTmPE1HXUZfz7SxefS67XGfPD/j01/MuTQzZAKOh0Nl16ee9FNOZCYi1BRc6MQn/9+Oa6nltP5ARmJ8Qa8SHjMo7xvVEh8SWZQIYHZZf9ASg="
install:
    - pip install -r requirements.txt
before_script:
    - psql -c "create user $DB_USER with createdb encrypted password '$DB_PASS';" -U postgres
    - psql -c "create database $DB_NAME with owner $DB_USER" -U postgres
    - cd src
script:
    - python ./manage.py migrate
    - python ./manage.py collectstatic -c --noinput
    - python ./manage.py test
