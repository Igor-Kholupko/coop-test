language: python
python: '3.7'
dist: xenial
sudo: true
services:
    - postgresql
env:
    global:
        - DB_HOST=127.0.0.1
        - DB_PORT=5432
        - secure: MG44oW5ULTLDmKcSv4Mf4HmDYvf5HLSs0UWcTw12nczz+dCHjd/Yq/mOOZcimCoWUQSgEMUsVFC+FSc/0+YBrkQw36Acuk16SjhlTe5GPB32hVkTWCQBBMXmA1ErDQFtuRIGDkED6Tcpa2cSDi4/xZZnOfsZhTNGLP5fBpI2xj1/91VsvOfUip7dBEYFSsB47i6Qhjs9HRQ+H3uttpLF6UTpdSLtCjybI31WHoDwsil750mUdBfZrfvTjYn+j+f+j0nxlPXkmbzmoCDaueNNF0S10DDItyaXbEiST9abVXPMDGZdIn9D8ChUJlmBQl25T6UPXa81GSthLpe+nh28+pei83w7KQ3TtOx77DaGcY143i5+YdQzo8xvOne/cfuSO/6UbPLOU+vxzTh9JNG3dH2UQiM4ObzRxXs/9H02YU5MDdqFn9i7CapX74wgh7c6KJ+pBKrnfxvMHwWvmLAsBAXnve7rwvbYK/eZcgzRur/kN8DBWOtNDwQMg5Yd1ddKbSinvcIdQmjLXFH4yWQ+dpJOQeZ+am+a4X9GJPi8myZZTjvxfZRlIjtRMdbLVcP7SH2XRjvrz287qo8vtEufu8Npd+45M/A3b+eIkXLo0vC0pHiqHTRTOBex6QYjt7wSpR3mWRe8fHRpNJz/qIl054JsklqcqEkCcFmwE9DsMeI=
install:
    - pip install -r requirements.txt
before_script:
    - psql -c "create user $DB_USER with createdb encrypted password '$DB_PASS';" -U postgres
    - psql -c "create database $DB_NAME with owner $DB_USER" -U postgres
    - cd src
script:
    - python ./manage.py migrate
    - python ./manage.py collectstatic -c --noinput
    - python ./manage.py test
