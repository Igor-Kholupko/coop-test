language: python
python: '3.7'
dist: xenial
sudo: true
services:
    - postgresql
env:
    global:
        - DB_HOST=127.0.0.1
        - DB_PORT=5432
        - secure: "S2XaMbYwMwV57H3pg7IgZu9Y/lQPSjQtPevhf29VwAuNaIs+geGNRysCzwMgTO5JtXyrLNc2MreExC58LJyiR8oocZ0WL4aK0cjSwEuG85JZn74y45m9pdSHeVCL8SNPstm6BpBsaWWiUfB6qSjV8+kcAODrwZKwReKMBXf66+SwF0uhA3NV9VEHwNUIxcV5/yWMk48wpOTijh8HgVwIsk1kxU0aGI1OkSVqOCfZXKll0dCdCXwZVoica18PdS0M32uuQ5aWCOawryjvG8YlIAT/7NIX/bII5aNGvTjh5JFlIpqXqVzXvepdkfnGZ1UOyqPriqs6p5d2RPnII/Y8bb3D7A+8aGTFDYUplS+LlsmTcn281BugDC9GiKBcIsrRQbM0GZIBfOrtDZVGZETZZ0OzO5XtFsN1e9k+E7W3h6ovd0EVPyA1zeARnzciWZ8YpBfEcb5FUz9fcVkvnSjqT5mEixTo6VMb1b9vedXXDeNWstOMfpzvlX/u6s8Slfnft/0FHnT1AZKlJjBTCCHeWB21Ky94sByG7ND+J/Rj3XCDqcHr7VZUoPWpbgWuhvpK2HqYPTWAtVHajGD0/KK3jYgSkemeP6ScIxnWGLjvEq71tNPCM2SkYpo47x4NFvUU4Y/uhgCHhin0mq9h6FlENJFXmV37Tupf0JrNHNVaIRo="
install:
    - pip install -r requirements.txt
before_script:
    - psql -c "create user $DB_USER with createdb encrypted password '$DB_PASS';" -U postgres
    - psql -c "create database $DB_NAME with owner $DB_USER" -U postgres
    - cd src
script:
    - python ./manage.py migrate
    - python ./manage.py collectstatic -c --noinput
    - python ./manage.py test
